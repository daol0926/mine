"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function _createClass(e,t,a){return t&&_defineProperties(e.prototype,t),a&&_defineProperties(e,a),e}!function(){var o="dragObjComplete",r="complete",e=function(){function i(e){_classCallCheck(this,i),this.QUIZ=e,this.TOTAL_COUNT=0}return _createClass(i,[{key:"checkAnswers",value:function(e,t){if(!t)return!1;var e=e.element.getAttribute("data-drag-obj-answer")||"",e=switchStringNumListToArray(e,","),t=t.element.getAttribute("data-drop-area-answer")||"",a=switchStringNumListToArray(t,",");return e.some(function(t){return a.some(function(e){return t===e})})}},{key:"init",value:function(){this.initGame(),this.initPopupOpenCallback(),this.initSliderMoveCallback()}},{key:"initGame",value:function(){var e=this,t=this.QUIZ.container,a=t.querySelectorAll(".js-dropArea"),n=t.querySelectorAll(".js-dragObj");this.game=initDragDrop({elements:{container:t,areas:a,objs:n},callbacks:{end:i.endCallback,movedOut:i.movedOutCallback,getZoomRate:function(){return e.getZoomRate()}},movedOutCorrPx:20}),(this.game.quiz=this).game.init(),t.addEventListener("pointerup",function(e){e.stopPropagation()})}},{key:"initPopupOpenCallback",value:function(){var t=this;window.$popupCallBack||(window.$popupCallBack={}),window.$popupCallBack.open=function(e){"pageChange"===e.Mode&&t.popupOpenCallback()}}},{key:"initSliderMoveCallback",value:function(){var e=this;window.$callBack.sliderMove||(window.$callBack.sliderMove=function(){e.sliderMoveCallback()})}},{key:"sliderMoveCallback",value:function(){this.reset()}},{key:"endCorrect",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:this.game.movingObj,t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:this.game.droppedArea;this.TOTAL_COUNT++,this.QUIZ.option.copy||(e.disable(!0),i.dragObjCompleteClass(e,!0)),this.copyObj(),i.completeArea(t),this.checkTotalComplete()}},{key:"endWrong",value:function(){this.game.movingObj.resetPosition()}},{key:"copyObj",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:this.game.movingObj,t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:this.game.droppedArea;e.resetPosition();e=e.element.cloneNode(!0);i.dragObjCompleteClass(e,!0),t.element.appendChild(e)}},{key:"showAnswer",value:function(){var a=this,e=this.game.dragObjs,n=this.game.dropAreas;e.forEach(function(t){n.forEach(function(e){a.checkAnswers(t,e)&&(i.dropAreaHasCopied(t,e)||(a.copyObj(t,e),i.dragObjCompleteClass(t,!0))),e.disable(!0)}),t.disable(!0)}),this.QUIZ.container.classList.add(r)}},{key:"reset",value:function(){var e=this.game,t=this.QUIZ.answerBtn;t&&t.dataset.option&&-1<t.dataset.option.indexOf("resetOnly")&&t.classList.add("reset"),this.QUIZ.container.classList.remove(r),this.TOTAL_COUNT=0,this.resetAreas(),this.resetObjs(),e.initDragObjsCoords(),e.setZoomRate()}},{key:"resetObjs",value:function(){this.game.dragObjs.forEach(function(e){e.disable(!1),i.dragObjCompleteClass(e,!1)})}},{key:"resetAreas",value:function(){this.game.dropAreas.forEach(function(e){for(var t,a=e.element.querySelectorAll(".".concat(o)),n=0,i=a.length;n<i;n++)t=a[n],e.element.removeChild(t);e.disable(!1)})}},{key:"popupOpenCallback",value:function(){this.reset()}},{key:"getZoomRate",value:function(){var e=this.game.container.element;return{x:e.getBoundingClientRect().width/e.offsetWidth,y:e.getBoundingClientRect().height/e.offsetHeight}}},{key:"checkTotalComplete",value:function(){this.TOTAL_COUNT===this.TOTAL_COMPLETE_COUNT&&(this.QUIZ.container.classList.add(r),this.QUIZ.toggleAnswerBtn())}},{key:"TOTAL_COMPLETE_COUNT",get:function(){this.game.container;var e=this.game.container.element.hasAttribute("data-total-complete-count")&&this.game.container.element.getAttribute("data-total-complete-count"),e=parseInt(e);return e=isNaN(e)?0:e}}],[{key:"endCallback",value:function(e){var t=e.movingObj,a=e.droppedArea,n=e.quiz,t=!n.QUIZ.option.answer||n.checkAnswers(t,a);a&&t?(n.endCorrect(),window.$efSound.correct(),window.$callBack&&window.$callBack.dragCorrect&&window.$callBack.dragCorrect(e)):(n.endWrong(),window.$efSound.incorrect(),window.$callBack&&window.$callBack.dragIncorrect&&window.$callBack.dragIncorrect(e))}},{key:"movedOutCallback",value:function(e){}},{key:"completeArea",value:function(e){var t=e,a=-1<(t.element.dataset.option||"").indexOf("complete"),n=i.getCompleteCnt(t.element),e=t.element.querySelectorAll(".js-dragObj")&&t.element.querySelectorAll(".js-dragObj").length||0;a&&n===e&&t.disable(!0)}},{key:"getCompleteCnt",value:function(e){return parseInt(e.getAttribute("data-complete-count"))||1}},{key:"convertScaleStringToArray",value:function(e){e=e.split(",");return[e[0].split("(")[1],e[1].trim().split(")")[0]].map(function(e){return parseFloat(e.trim())})}},{key:"dragObjCompleteClass",value:function(e,t){e=e instanceof DragObj?e.element:e;t?e.classList.add(o):e.classList.remove(o)}},{key:"dropAreaHasCopied",value:function(e,t){for(var a,n=t.element.children,i=0,o=n.length;i<o;i++)if(a=n[i],e.element.className===a.className)return!0;return!1}}]),i}();window.$dragDrop=e}();