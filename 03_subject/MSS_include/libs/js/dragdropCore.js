"use strict";function _typeof2(e){return(_typeof2="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"===_typeof2(Symbol.iterator)?function(e){return _typeof2(e)}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":_typeof2(e)})(e)}function _possibleConstructorReturn(e,t){return!t||"object"!==_typeof(t)&&"function"!=typeof t?_assertThisInitialized(e):t}function _assertThisInitialized(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _getPrototypeOf(e){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&_setPrototypeOf(e,t)}function _setPrototypeOf(e,t){return(_setPrototypeOf=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function _createClass(e,t,n){return t&&_defineProperties(e.prototype,t),n&&_defineProperties(e,n),e}var DOM=function(){function t(e){_classCallCheck(this,t),this.element=e.element,(this.element.self=this).name=e.name||"noname",this.attrName=e.attrName||e.name||null,this.getScale=e.getScale,this.DISABLED=!1}return _createClass(t,[{key:"hasClass",value:function(e){return this.element.classList.contains(e)}},{key:"addClass",value:function(e){return this.element.classList.add(e)}},{key:"removeClass",value:function(e){return this.element.classList.remove(e)}},{key:"hasAttr",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:this.attrName;return this.element.hasAttribute(e)}},{key:"getAttr",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:this.attrName;return this.element.getAttribute(e)}},{key:"setAttr",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:this.attrName;this.element.setAttribute(e,1<arguments.length?arguments[1]:void 0)}},{key:"setStyles",value:function(e){if(e.constructor===Object)for(var t,n=Object.getOwnPropertyNames(e),o=0,r=n.length;o<r;o++)t=n[o],this.element.style[t]=e[t]}},{key:"pointerOff",value:function(){this.setStyles({cursor:"default",pointerEvents:"none"})}},{key:"pointerOn",value:function(){this.setStyles({cursor:"pointer",pointerEvents:"auto"})}},{key:"show",value:function(){this.setStyles({opacity:"1",visibility:"visible"})}},{key:"hide",value:function(){this.setStyles({opacity:"0",visibility:"hidden"})}},{key:"addEvent",value:function(e,t){switch(e){case"down":this.element.addEventListener("mousedown",t),this.element.addEventListener("touchstart",t);break;case"move":this.element.addEventListener("mousemove",t),this.element.addEventListener("touchmove",t);break;case"up":this.element.addEventListener("mouseup",t),this.element.addEventListener("touchend",t);break;default:this.element.addEventListener(e,t)}}},{key:"removeEvent",value:function(e,t){switch(e){case"down":this.element.removeEventListener("mousedown",t),this.element.removeEventListener("touchstart",t);break;case"move":this.element.removeEventListener("mousemove",t),this.element.removeEventListener("touchmove",t);break;case"up":this.element.removeEventListener("mouseup",t),this.element.removeEventListener("touchend",t);break;default:this.element.removeEventListener(e,t)}}},{key:"eventIsOn",value:function(e,t){var n=this.sizes,o=n.left,r=n.top,s=n.width,i=n.height,a=t||0,n=e.x>o-a,t=e.y>r-a,s=e.x<o+s+a,i=e.y<r+i+a,a=this.DISABLED;return n&&t&&s&&i&&!a}},{key:"disable",value:function(e){this.DISABLED=e}},{key:"sizes",get:function(){return this.element.getBoundingClientRect()}},{key:"styles",get:function(){return window.getComputedStyle(this.element)}},{key:"scale",get:function(){return this.getScale?this.getScale():1}},{key:"offsets",get:function(){var e=this.element;return{y:e.offsetTop,x:e.offsetLeft,width:e.offsetWidth,height:e.offsetHeight}}}],[{key:"eventMaster",value:function(e){var t,n=e.type;return o(n,"mouse")?t=e:o(n,"touch")&&(t=(o(n,"touchend")?e.changedTouches:e.touches)[0]),t.coords={x:t.clientX,y:t.clientY},t;function o(e,t){return-1<e.indexOf(t)}}}]),t}(),Container=function(){function i(e){var t;return _classCallCheck(this,i),(t=_possibleConstructorReturn(this,_getPrototypeOf(i).call(this,e))).dragDrop=e.dragDrop,t}return _inherits(i,DOM),_createClass(i,[{key:"init",value:function(){this.addEvents()}},{key:"addEvents",value:function(){this.addEvent("down",i.downEventCallback)}},{key:"movedOut",value:function(e){var t=e.x,n=e.y,o=this.sizes.x,r=this.sizes.y,s=o+this.sizes.width,i=r+this.sizes.height,a=window.innerWidth,l=window.innerHeight,e=this.dragDrop.movedOutCorrPx;return t<=o+e||t<=e||(s-e<=t||a-e<=t)||(n<=r+e||n<=e)||(i-e<=n||l-e<=n)}}],[{key:"downEventCallback",value:function(e){for(var t=e.target;(t.self&&t.self.constructor)!==i;)t=t.parentNode;var n=t.self.dragDrop,o=n.container;n.movingObj=n.objOnEvent(e),n.movingObj&&(o.addEvent("move",i.moveEventCallback),o.addEvent("up",i.upEventCallback),o=(e=n.movingObj).name,window.dragStartCallbacks&&window.dragStartCallbacks[o]&&"noname"!==o&&window.dragStartCallbacks[o](e)),n.callbacks&&n.callbacks.start&&n.callbacks.start(n)}},{key:"moveEventCallback",value:function(e){for(var t=e.target;(t&&t.self&&t.self.constructor)!==i;)t=t.parentNode;var n=t.self.dragDrop,o=n.movingObj,r=n.container,s=DOM.eventMaster(e).coords,e=r.movedOut(s),r=o.name;e?n.movedOut():(o.MOVED_COORDS=s,o.move(),n.callbacks&&n.callbacks.move&&n.callbacks.move(n),window.dragMoveCallbacks&&window.dragMoveCallbacks[r]&&"noname"!==r&&window.dragMoveCallbacks[r](o))}},{key:"upEventCallback",value:function(e){for(var t=e.target;(t.self&&t.self.constructor)!==i;)t=t.parentNode;var n=t.self,o=n.dragDrop,r=o.movingObj,s=o.droppedArea,r=r.name,s=s&&s.name;o.droppedArea=o.areaOnEvent(e),o.callbacks&&o.callbacks.end&&o.callbacks.end(o),window.dragDropCallbacks&&(window.dragDropCallbacks[r]&&"noname"!==r&&window.dragDropCallbacks[r](o),window.dragDropCallbacks[s]&&"noname"!==s&&window.dragDropCallbacks[s](o)),n.removeEvent("move",i.moveEventCallback),n.removeEvent("up",i.upEventCallback)}}]),i}(),DragObj=function(){function o(e){var t;return _classCallCheck(this,o),(t=_possibleConstructorReturn(this,_getPrototypeOf(o).call(this,e))).dragDrop=e.dragDrop,t.DISABLED=!1,t}return _inherits(o,DOM),_createClass(o,[{key:"init",value:function(){this.initCoords(),this.addEvents()}},{key:"initCoords",value:function(){var e=this.offsets,t=e.x,e=e.y;this.NON_SCALED_COORDS={x:t,y:e}}},{key:"addEvents",value:function(){this.addEvent("down",o.downEventHandler)}},{key:"move",value:function(e){var t=this.dragDrop.ZOOM_RATE,n=this.MOVED_COORDS,o=n.x/t.x,r=n.y/t.y,n=this.NON_SCALED_COORDS,t=n.x,n=n.y,o=e?t+e.x:t+o,r=e?n+e.y:n+r,r="".concat(r,"px"),o="".concat(o,"px");this.setStyles({position:"absolute",top:r,left:o})}},{key:"resetPosition",value:function(){this.setStyles({position:"",top:"",left:""})}},{key:"getScaledCoords",value:function(){var e=this.dragDrop.container,t=this.sizes,e=e.sizes;return{x:t.left-e.left,y:t.top-e.top}}},{key:"NON_SCALED_COORDS",get:function(){return this._nonScaledCoords||{x:0,y:0}},set:function(e){this._nonScaledCoords=e}},{key:"STARTED_COORDS",get:function(){return this._startedCoords||{x:0,y:0}},set:function(e){this._startedCoords=e}},{key:"MOVED_COORDS",get:function(){return this._movedCoords||{x:0,y:0}},set:function(e){this._movedCoords||(this._movedCoords={}),this._movedCoords.x=e.x-this.STARTED_COORDS.x,this._movedCoords.y=e.y-this.STARTED_COORDS.y}}],[{key:"downEventHandler",value:function(e){for(var t=e.target;(t.self&&t.self.constructor)!==o;)t=t.parentElement;var n=t.self,e=n.dragDrop;n.NON_SCALED_COORDS,n.getScaledCoords();e.setZoomRate()}}]),o}(),DropArea=function(){function n(e){var t;return _classCallCheck(this,n),(t=_possibleConstructorReturn(this,_getPrototypeOf(n).call(this,e))).dragDrop=e.dragDrop,t}return _inherits(n,DOM),_createClass(n,[{key:"init",value:function(){}}]),n}(),DragDropCore=function(){function t(e){_classCallCheck(this,t),this.elements=e.elements,this.callbacks=e.callbacks,this._container=null,this._dragObjs=[],this._dropAreas=[],this.getZoomRate=e.callbacks.getZoomRate,this.movedOutCorrPx=e.movedOutCorrPx||10}return _createClass(t,[{key:"init",value:function(){this.initContainer(),this.initDragObjs(),this.initDropAreas(),this.addEvents()}},{key:"initContainer",value:function(){var e=this.elements.container,t=e.dataset.name||null;e&&(this.container=new Container({element:e,name:t,dragDrop:this}),this.container.init())}},{key:"initDragObjs",value:function(){for(var e,t,n=this.elements.objs,o=0,r=n.length;o<r;o++)t=(e=n[o]).dataset.name||null,(t=new DragObj({element:e,name:t,dragDrop:this})).init(),this.dragObjs=t}},{key:"initDropAreas",value:function(){for(var e,t,n=this.elements.areas,o=0,r=n.length;o<r;o++)t=(e=n[o]).dataset.name||null,(t=new DropArea({element:e,name:t,dragDrop:this})).init(),this.dropAreas=t}},{key:"addEvents",value:function(){}},{key:"objOnEvent",value:function(e){for(var t,n=DOM.eventMaster(e).coords,e=e.type,o="mousedown"===e||"touchstart"===e,r=this.dragObjs,s=0,i=r.length;s<i;s++)if((t=r[s]).eventIsOn(n))return o&&(t.STARTED_COORDS=n),t}},{key:"areaOnEvent",value:function(e){for(var t,n=DOM.eventMaster(e).coords,o=this.dropAreas,r=0,s=o.length;r<s;r++)if((t=o[r]).eventIsOn(n))return t}},{key:"setZoomRate",value:function(){this.ZOOM_RATE=this.getZoomRate()||1}},{key:"disableObjs",value:function(t){this.dragObjs.forEach(function(e){e.disable(t)})}},{key:"disableAreas",value:function(t){this.dropAreas.forEach(function(e){e.disable(t)})}},{key:"initDragObjsCoords",value:function(){this.dragObjs.forEach(function(e){e.initCoords()})}},{key:"movedOut",value:function(){var e=this.container;this.movingObj.resetPosition(),this.movingObj=null,e.removeEvent("move",Container.moveEventCallback),e.removeEvent("up",Container.upEventCallback),this.callbacks&&this.callbacks.movedOut&&this.callbacks.movedOut(this)}},{key:"container",get:function(){return this._container},set:function(e){this._container=e}},{key:"dragObjs",get:function(){return this._dragObjs},set:function(e){this.dragObjs.push(e)}},{key:"dropAreas",get:function(){return this._dropAreas},set:function(e){this._dropAreas.push(e)}},{key:"ZOOM_RATE",get:function(){return this._zoomRate||{x:1,y:1}},set:function(e){this._zoomRate=e}},{key:"movingObj",get:function(){return this._movingObj},set:function(e){this._movingObj=e}},{key:"droppedArea",get:function(){return this._droppedArea},set:function(e){this._droppedArea=e}}]),t}();function initDragDrop(e){var t=e.elements,n=e.callbacks,e=e.movedOutCorrPx,e=new DragDropCore({elements:t,callbacks:n,movedOutCorrPx:e});return n&&n.init&&n.init(e),e}